(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t){e.classList.remove(t.inputErrorClass);var n="".concat(e.id,"-error");document.getElementById(n).textContent=""}function n(e,n){e.reset(),e.querySelectorAll(n.inputSelector).forEach((function(e){t(e,n)}))}function o(e){e.disabled=!0}function r(e,n){var r=e.querySelector(n.submitButtonSelector);e.querySelectorAll(n.inputSelector).forEach((function(c){c.addEventListener("input",(function(){(function(e,n){e.validity.valid?t(e,n):function(e,t,n){e.classList.add(n.inputErrorClass);var o="".concat(e.id,"-error"),r=document.getElementById(o);r?r.textContent=t:console.error("Error element with id '".concat(o,"' not found"))}(e,e.validationMessage,n)})(c,n),function(e,t){e.checkValidity()?t.disabled=!1:o(t)}(e,r)}))}))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",l)}function a(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",l)}function l(e){"Escape"===e.key&&a(document.querySelector(".popup_opened"))}e.d({},{H:()=>C});var i={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-12",headers:{authorization:"e85605fa-1b94-4540-ab40-bcd2b4ead3cb","Content-Type":"application/json"}},s=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},u=document.forms.delete_card,d=null;function m(e,t,n,o,r){var a=n.cloneNode(!0),l=a.querySelector(r.imageSelector),m=a.querySelector(r.titleSelector),f=a.querySelector(r.likeButtonSelector),p=a.querySelector(r.likeCountSelector),v=a.querySelector(r.deleteButtonSelector);return e.owner._id!==t?v.remove():v.addEventListener("click",(function(t){u.elements.save.textContent=u.elements.save.ariaLabel,c(C),(d=t.target.closest(".element")).id=e._id})),Boolean(e.likes.find((function(e){return e._id===t})))&&f.classList.add("element__like_active"),f.addEventListener("click",(function(){f.classList.contains("element__like_active")?function(e,t,n){var o;e.classList.add("element__like_active"),(o=n._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:i.headers}).then(s)).then((function(n){t.textContent=n.likes.length||"",e.classList.remove("element__like_active"),console.log("Меня дизлайкнули ".concat(e.classList))})).catch((function(e){return console.log(e)}))}(f,p,e):function(e,t,n){var o;(o=n._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:i.headers}).then(s)).then((function(n){e.classList.add("element__like_active"),console.log("Меня лайкнули ".concat(e.classList)),t.textContent=n.likes.length})).catch((function(e){return console.log(e)}))}(f,p,e)})),p.textContent=e.likes.length||"",l.src=e.link,l.alt=e.name,m.textContent=e.name,l.addEventListener("click",(function(){o(l.src,l.alt)})),a}function f(e,t,n){e[n](t)}var p,v,h=document.querySelector(".profile"),_=h.querySelector(".profile__name"),y=h.querySelector(".profile__description"),S=h.querySelector(".profile__avatar"),g=h.querySelector(".profile__edit"),E=h.querySelector(".profile__add"),b=Array.from(document.getElementsByClassName("popup")),k=(document.querySelector(".element"),document.getElementById("edit-profile")),L=document.getElementById("open-image"),C=document.getElementById("delete-card"),x=L.querySelector(".popup__image"),q=L.querySelector(".popup__caption"),B=document.getElementById("add-card"),U=document.getElementById("edit-profile_photo"),I=document.forms.profile,w=document.forms.profile_photo,N=document.forms.card,O=I.elements.name,P=I.elements.about,T=N.elements.name,A=N.elements.link,D=w.elements.link,j=document.querySelector(".elements__list"),H=document.getElementById("card").content.querySelector(".element").cloneNode(!0),J={imageSelector:".element__image",titleSelector:".element__title",likeButtonSelector:".element__like",likeCountSelector:".element__like-count",deleteButtonSelector:".element__delete"},z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inputErrorClass:"popup__input_type_error"};function M(e,t){c(L),x.src=e,x.alt=t,q.textContent=t}fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then(s).then((function(e){_.textContent=e.name,y.textContent=e.about,S.src=e.avatar,p=e._id})).catch((function(e){console.log(e)})),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then(s).then((function(e){e.forEach((function(e){var t=m(e,p,H,M,J);f(j,t,"append")}))})).catch((function(e){console.log(e)})),console.log(I.elements.save.textContent),g.addEventListener("click",(function(){I.elements.save.textContent=I.elements.save.ariaLabel,c(k),n(I,z),O.value=_.textContent,P.value=y.textContent})),E.addEventListener("click",(function(){N.elements.save.textContent=N.elements.save.ariaLabel,c(B),n(N,z),o(N.elements.save)})),S.parentNode.addEventListener("click",(function(){w.elements.save.textContent=w.elements.save.ariaLabel,c(U),n(w,z),o(w.elements.save)})),v=z,document.querySelectorAll(v.formSelector).forEach((function(e){e.addEventListener("input",(function(){return r(e,v)}))})),I.addEventListener("submit",(function(e){var t,n;e.preventDefault(),(t=O.value,n=P.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:n})}).then(s)).then((function(e){_.textContent=e.name,y.textContent=e.about,a(k)})).catch((function(e){return console.log(e)})).finally((function(){return I.elements.save.textContent="Сохранение..."}))})),N.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:String(T.value),link:String(A.value)},fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t.name,link:t.link})}).then(s)).then((function(t){var n=m(t,p,H,M,J);f(j,n,"prepend"),e.target.reset(),a(B)})).catch((function(e){return console.log(e)})).finally((function(){return N.elements.save.textContent="Сохранение..."}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=D.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then(s)).then((function(){S.src=D.value,S.alt=_.textContent,e.target.reset(),a(U)})).catch((function(e){return console.log(e)})).finally((function(){return w.elements.save.textContent="Сохранение..."}))})),C.addEventListener("submit",(function(e){return e.preventDefault(),(t=d.id,fetch("".concat(i.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:i.headers}).then(s)).then((function(){d.remove(),a(C),d=null})).catch((function(e){return console.log(e)})).finally((function(){return C.querySelector(".popup__save").textContent="Удаление..."}));var t})),b.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&a(e),t.target.classList.contains("popup__close")&&a(e)}))}))})();