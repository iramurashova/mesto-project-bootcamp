(()=>{"use strict";function e(e,t){e.classList.remove(t.inputErrorClass);var n="".concat(e.id,"-error");document.getElementById(n).textContent=""}function t(t,n){t.reset(),t.elements.save.textContent=t.elements.save.ariaLabel,t.querySelectorAll(n.inputSelector).forEach((function(t){e(t,n)}))}function n(e){e.disabled=!0}function o(t,o){var c=t.querySelector(o.submitButtonSelector);t.querySelectorAll(o.inputSelector).forEach((function(r){r.addEventListener("input",(function(){(function(t,n){t.validity.valid?e(t,n):function(e,t,n){e.classList.add(n.inputErrorClass);var o="".concat(e.id,"-error"),c=document.getElementById(o);c?c.textContent=t:console.error("Error element with id '".concat(o,"' not found"))}(t,t.validationMessage,n)})(r,o),function(e,t){e.checkValidity()?t.disabled=!1:n(t)}(t,c)}))}))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",a)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}var l={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-12",headers:{authorization:"e85605fa-1b94-4540-ab40-bcd2b4ead3cb","Content-Type":"application/json"}},i=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function s(e,t,n,o,c){var r=n.cloneNode(!0),a=r.querySelector(c.imageSelector),s=r.querySelector(c.titleSelector),u=r.querySelector(c.likeButtonSelector),d=r.querySelector(c.likeCountSelector),f=r.querySelector(c.deleteButtonSelector);return Boolean(e.likes.find((function(e){return e._id===t})))&&u.classList.add("element__like_active"),u.addEventListener("click",(function(){u.classList.contains("element__like_active")?function(e,t,n){var o;e.classList.add("element__like_active"),(o=n._id,fetch("".concat(l.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:l.headers}).then(i)).then((function(n){t.textContent=n.likes.length||"",e.classList.remove("element__like_active"),console.log("Меня дизлайкнули ".concat(e.classList))})).catch((function(e){return console.log(e)}))}(u,d,e):function(e,t,n){var o;(o=n._id,console.log("".concat(l.baseUrl,"/cards/likes/").concat(o)),fetch("".concat(l.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:l.headers}).then(i)).then((function(n){e.classList.add("element__like_active"),console.log("Меня лайкнули ".concat(e.classList)),t.textContent=n.likes.length})).catch((function(e){return console.log(e)}))}(u,d,e)})),d.textContent=e.likes.length||"",e.owner._id===t?(f.disabled=!1,f.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).then(i)).then((function(){r.remove()})).catch((function(e){return console.log(e)}))}))):f.disabled=!0,a.src=e.link,a.alt=e.name,s.textContent=e.name,a.addEventListener("click",(function(){o(a.src,a.alt)})),r}function u(e,t,n){e[n](t)}var d,f=document.querySelector(".profile"),m=f.querySelector(".profile__name"),p=f.querySelector(".profile__description"),h=f.querySelector(".profile__avatar"),v=f.querySelector(".profile__edit"),_=f.querySelector(".profile__add"),y=Array.from(document.getElementsByClassName("popup")),S=document.getElementById("edit-profile"),g=document.getElementById("open-image"),E=g.querySelector(".popup__image"),k=g.querySelector(".popup__caption"),b=document.getElementById("add-card"),L=document.getElementById("edit-profile_photo"),C=document.forms.profile,q=document.forms.profile_photo,x=document.forms.card,B=C.elements.name,U=C.elements.about,I=x.elements.name,N=x.elements.link,T=q.elements.link,w=document.querySelector(".elements__list"),A=document.getElementById("card").content.querySelector(".element").cloneNode(!0),D={imageSelector:".element__image",titleSelector:".element__title",likeButtonSelector:".element__like",likeCountSelector:".element__like-count",deleteButtonSelector:".element__delete"},P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inputErrorClass:"popup__input_type_error"},O="";function j(e,t){c(g),E.src=e,E.alt=t,k.textContent=t}fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(i).then((function(e){m.textContent=e.name,p.textContent=e.about,h.src=e.avatar,O=e._id})).catch((function(e){console.log(e)})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(i).then((function(e){e.forEach((function(e){var t=s(e,O,A,j,D);u(w,t,"append")}))})).catch((function(e){console.log(e)})),v.addEventListener("click",(function(){c(S),t(C,P),B.value=m.textContent,U.value=p.textContent})),_.addEventListener("click",(function(){c(b),t(x,P),n(x.elements.save)})),h.parentNode.addEventListener("click",(function(){c(L),t(q,P),n(q.elements.save)})),d=P,document.querySelectorAll(d.formSelector).forEach((function(e){e.addEventListener("input",(function(){return o(e,d)}))})),C.addEventListener("submit",(function(e){var t,n;e.preventDefault(),(t=B.value,n=U.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}).then(i)).then((function(e){m.textContent=e.name,p.textContent=e.about,r(S),console.log(e)})).catch((function(e){return console.log(e)})).finally((function(){return C.elements.save.textContent="Сохранение..."}))})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:String(I.value),link:String(N.value)},fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t.name,link:t.link})}).then(i)).then((function(t){var n=s(t,O,j,D);u(w,n,"prepend"),e.target.reset(),r(b)})).catch((function(e){return console.log(e)})).finally((function(){return x.elements.save.textContent="Сохранение..."}))})),L.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=T.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(i)).then((function(){h.src=T.value,h.alt=m.textContent,e.target.reset(),r(L)})).catch((function(e){return console.log(e)})).finally((function(){return q.elements.save.textContent="Сохранение..."}))})),y.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&r(e),t.target.classList.contains("popup__close")&&r(e)}))}))})();